<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="gantt_template" name="Cronológico de Mantenimiento">
        <t t-call="web.layout">
            <t t-set="title">Cronológico de Mantenimiento</t>
            <t t-set="head">
                <!-- Bootstrap 4 y dependencias -->
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous"/>
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
                <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
                <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
                
                <!-- jQuery UI para datepicker -->
                <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>
                <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
                
                <!-- Script personalizado -->
                <script type="text/javascript" src="/mantenimientosx/static/src/js/mantenimientosx_gantt.js"></script>
                
                <style>
                    :root {
                        --primary-color: #8a7cb8;
                        --secondary-color: #71639e;
                        --success-color: #2ecc71;
                        --warning-color: #f1c40f;
                        --danger-color: #e74c3c;
                        --info-color: #3498db;
                    }
                    
                    body {
                        background-color: #f8f9fa;
                        font-family: 'Roboto', sans-serif;
                    }
                    
                    .header-container {
                        background-color: #71639e;
                        color: white;
                        padding: 10px 0;
                        margin-bottom: 15px;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                    }
                    
                    .app-title {
                        font-size: 18px;
                        font-weight: 600;
                        margin: 0;
                    }
                    
                    .back-button {
                        color: white;
                        background-color: rgba(255, 255, 255, 0.2);
                        border: none;
                        border-radius: 4px;
                        padding: 8px 15px;
                        transition: all 0.3s ease;
                    }
                    
                    .back-button:hover {
                        background-color: rgba(255, 255, 255, 0.3);
                        color: white;
                        text-decoration: none;
                    }
                    
                    .control-panel {
                        background-color: white;
                        border-radius: 8px;
                        padding: 12px;
                        margin-bottom: 15px;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                    }
                    
                    .date-filter label {
                        font-weight: 600;
                        color: var(--secondary-color);
                    }
                    
                    .filter-button {
                        background-color: var(--secondary-color);
                        border-color: var(--secondary-color);
                        font-size: 0.875rem;
                        padding: 0.25rem 0.5rem;
                    }
                    
                    .filter-button:hover {
                        background-color: #5d5286;
                        border-color: #5d5286;
                    }
                    
                    .export-button:hover {
                        background-color: #27ae60;
                        border-color: #27ae60;
                    }
                    
                    .search-box {
                        position: relative;
                    }
                    
                    .form-control {
                        padding: 0.375rem 0.75rem;
                        font-size: 0.875rem;
                        height: calc(1.5em + 0.75rem + 2px);
                        border-radius: 4px;
                    }
                    
                    .search-box .search-icon {
                        position: absolute;
                        right: 15px;
                        top: 10px;
                        color: #aaa;
                    }
                    
                    .gantt-container {
                        margin: 0 20px 20px 20px;
                        overflow-x: auto;
                    }
                    
                    .gantt-table {
                        border-collapse: collapse;
                        width: 100%;
                        background-color: white;
                        border-radius: 8px;
                        overflow: hidden;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                    }
                    
                    .gantt-table th, .gantt-table td {
                        border: 1px solid #e9ecef;
                        padding: 6px;
                        text-align: center;
                        font-size: 0.875rem;
                    }
                    
                    .gantt-table th {
                        background-color: #f8f9fa;
                        position: sticky;
                        top: 0;
                        z-index: 10;
                        font-weight: 600;
                        color: var(--secondary-color);
                    }
                    
                    .gantt-table .maquina-row {
                        background-color: #edf2f7;
                        font-weight: 600;
                    }
                    
                    .gantt-table .actividad-row {
                        background-color: white;
                    }
                    
                    .gantt-table .day-cell {
                        min-width: 30px;
                        width: 30px;
                    }
                    
                    .gantt-table .info-cell {
                        min-width: 80px;
                    }
                    
                    .gantt-table .maquina-cell {
                        text-align: left;
                        font-weight: 600;
                        min-width: 200px;
                        color: var(--secondary-color);
                    }
                    
                    .gantt-table .actividad-cell {
                        text-align: left;
                        padding-left: 20px;
                        min-width: 200px;
                    }
                    
                    .estado-normal {
                        background-color: #2ecc71; /* Verde */
                    }
                    
                    .estado-proximo {
                        background-color: #f1c40f; /* Amarillo */
                    }
                    
                    .estado-atrasado {
                        background-color: #e74c3c; /* Rojo */
                    }
                    
                    .estado-pendiente {
                        background-color: #3498db; /* Azul */
                    }
                    
                    .weekday-header {
                        font-size: 0.8em;
                        color: #7f8c8d;
                    }
                    
                    .month-header {
                        background-color: #edf2f7;
                        text-align: center;
                        font-weight: 600;
                        color: var(--secondary-color);
                    }
                    
                    .legend-container {
                        background-color: white;
                        border-radius: 8px;
                        padding: 15px;
                        margin-bottom: 20px;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
                    }
                    
                    .legend-title {
                        font-weight: 600;
                        color: var(--secondary-color);
                        margin-bottom: 10px;
                    }
                    
                    .legend-item {
                        display: inline-flex;
                        align-items: center;
                        margin-right: 20px;
                        margin-bottom: 5px;
                    }
                    
                    .legend-color {
                        display: inline-block;
                        width: 20px;
                        height: 20px;
                        margin-right: 8px;
                        border-radius: 4px;
                    }
                    
                    .ui-datepicker {
                        font-size: 14px;
                    }
                    
                    /* Responsive */
                    @media (max-width: 768px) {
                        .control-panel {
                            padding: 15px;
                        }
                        
                        .app-title {
                            font-size: 20px;
                        }
                    }
                </style>
                <t t-set="pageName">Cronológico de Mantenimiento</t>
            </t>
            
            <!-- Header con logo y título -->
            <div class="header-container">
                <div class="container-fluid">
                    <div class="row align-items-center">
                        <div class="col-md-6 d-flex align-items-center">
                            <a href="/web#menu_id=menu_mantenimientosx_tablero" class="back-button mr-3">
                                <i class="fas fa-arrow-left mr-2"></i> Volver al menú principal
                            </a>
                            <h1 class="app-title">Cronológico de Mantenimiento</h1>
                        </div>
                        <div class="col-md-6 text-right">
                            <span class="text-light">
                                <i class="far fa-calendar-alt mr-1"></i> <t t-esc="datetime.datetime.now().strftime('%d/%m/%Y')"/>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="container-fluid">
                <!-- Panel de control -->
                <div class="control-panel">
                    <div class="row">
                        <div class="col-lg-7">
                            <form id="gantt-filter-form" class="form-inline date-filter">
                                <div class="form-group mr-2 mb-0">
                                    <label for="fecha_inicio" class="mr-1 small">Del:</label>
                                    <input type="text" class="form-control form-control-sm datepicker" id="fecha_inicio" name="fecha_inicio" placeholder="DD/MM/YYYY" t-att-value="fecha_inicio"/>
                                </div>
                                <div class="form-group mr-2 mb-0">
                                    <label for="fecha_fin" class="mr-1 small">al:</label>
                                    <input type="text" class="form-control form-control-sm datepicker" id="fecha_fin" name="fecha_fin" placeholder="DD/MM/YYYY" t-att-value="fecha_fin"/>
                                </div>
                                <button type="submit" class="btn btn-sm btn-primary filter-button">
                                    <i class="fas fa-filter mr-1"></i> Filtrar
                                </button>
                            </form>
                        </div>
                        <div class="col-lg-5">
                            <div class="row">
                                <div class="col-md-8 mb-2">
                                    <div class="search-box">
                                        <input type="text" id="gantt-search" class="form-control form-control-sm" placeholder="Buscar..."/>
                                        <i class="fas fa-search search-icon"></i>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-2 text-right">
                                    <!-- Enlace para exportar a Excel, solicitado por doña daysi en sus apuntes del word como procesos de desarrollo capitulo 3 -->
                                    <a href="/mantenimientosx/excel_export?fecha_inicio={{fecha_inicio}}&amp;fecha_fin={{fecha_fin}}" 
                                       class="btn btn-sm btn-outline-success" id="link-export-excel">
                                        <i class="fas fa-file-excel mr-1"></i> Exportar a Excel
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Leyenda de colores -->
                <div class="legend-container py-2">
                    <div class="d-flex flex-wrap align-items-center">
                        <h6 class="legend-title mb-0 mr-3">Leyenda:</h6>
                        <div class="legend-item mr-3">
                            <div class="legend-color estado-normal"></div>
                            <span class="small">Normal</span>
                        </div>
                        <div class="legend-item mr-3">
                            <div class="legend-color estado-proximo"></div>
                            <span class="small">Próximo (menos de 7 días)</span>
                        </div>
                        <div class="legend-item mr-3">
                            <div class="legend-color estado-atrasado"></div>
                            <span class="small">Atrasado</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color estado-pendiente"></div>
                            <span class="small">Orden Pendiente</span>
                        </div>
                    </div>
                </div>
                
                <!-- Tabla Gantt -->
                <div class="table-responsive">
                    <table class="gantt-table">
                        <thead>
                            <tr>
                                <th rowspan="2">Máquinas/Actividades</th>
                                <th rowspan="2">Último Mtto.</th>
                                <th rowspan="2">Intervalo Mtto.</th>
                                <th rowspan="2">Próximo Mtto.</th>
                                <th rowspan="2">Días Próx. Mtto.</th>
                                <th rowspan="2">Días Sig. Mtto.</th>
                                <!-- Meses con Horas Próx. Mtto. -->
                                <t t-foreach="meses" t-as="mes">
                                    <th t-att-colspan="mes['dias']" class="month-header">
                                        <span>Horas Próx. Mtto. </span><t t-esc="mes['nombre']"/>
                                    </th>
                                </t>
                            </tr>
                            <tr>
                                <!-- Días -->
                                <t t-foreach="dias" t-as="dia">
                                    <th class="day-cell">
                                        <div><t t-esc="dia['numero']"/></div>
                                        <div class="weekday-header"><t t-esc="dia['dia_semana']"/></div>
                                    </th>
                                </t>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="datos_cronologico" t-as="maquina">
                                <!-- Fila de máquina -->
                                <tr class="maquina-row">
                                    <td class="maquina-cell"><t t-esc="maquina['nombre']"/></td>
                                    <td colspan="5"></td>
                                    <t t-foreach="dias" t-as="dia">
                                        <td class="day-cell"></td>
                                    </t>
                                </tr>
                                
                                <!-- Filas de actividades -->
                                <t t-foreach="maquina['actividades']" t-as="actividad">
                                    <tr class="actividad-row">
                                        <td class="actividad-cell"><t t-esc="actividad['nombre']"/></td>
                                        <td class="info-cell"><t t-esc="actividad['ultimo_mto']"/></td>
                                        <td class="info-cell"><t t-esc="actividad['intervalo_mto']"/></td>
                                        <td class="info-cell"><t t-esc="actividad['proximo_mto']"/></td>
                                        <td class="info-cell"><t t-esc="actividad['dias_prox_mto']"/></td>
                                        <td class="info-cell"><t t-esc="actividad['dias_sig_mto']"/></td>
                                        
                                        <!-- Días - Mostrar horas_prox_mto en cada celda -->
                                        <t t-foreach="dias" t-as="dia">
                                            <t t-set="fecha" t-value="dia['fecha']"/>
                                            <t t-set="tiene_dato" t-value="fecha in actividad['fechas']"/>
                                            <t t-set="estado" t-value="actividad['fechas'][fecha]['estado'] if tiene_dato else ''"/>
                                            
                                            <td t-att-class="'day-cell estado-' + estado if tiene_dato else 'day-cell'">
                                                <t t-if="tiene_dato">
                                                    <t t-esc="actividad['horas_prox_mto']"/>
                                                </t>
                                            </td>
                                        </t>
                                    </tr>
                                </t>
                            </t>
                        </tbody>
                    </table>
                </div>
                
                <!-- Footer -->
                <div class="mt-4 mb-4 text-center text-muted">
                    <small>© <t t-esc="datetime.datetime.now().year"/> MantenimientosX - Todos los derechos reservados</small>
                </div>
            </div>
        </t>
    </template>
</odoo>
